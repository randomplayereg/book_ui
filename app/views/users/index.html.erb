<h1>User list</h1>

<div id="list">

</div>

<script>
$('document').ready(function(){
  if (getCookie("token")){
    $.ajax({
      url: "http://localhost:3000/api/v1/users/" + getCookie("user_id") + "/check_admin",
      headers: {
        "Authorization": "Token token=" + getCookie('token')
      },
      type: "GET",
      dataType: "json",
      success: function(data){
        console.log("admin ajax" + data);
        ajax_GetAllUsers(data.admin);
      }
    });
  }
});

function ajax_GetAllUsers(admin_session){
  $.ajax({
    type: "GET",
    url: "http://localhost:3000/api/v1/users",
    dataType: "json",
    success: function(data){
      console.log(data);

      $.each(data, function() {

        var admin_action = "<li><a href='/users/edit/" + this.id + "'>Edit</a>" + "</li>";
        var fragment = "<h4><strong>" + this.username + "</strong></h4>"
                      + "<ul>"
                        + "<li>Email: " + this.email + " " + "</li>"
                        + "<li><i>Created " + this.book_count + " book(s)</i>" + "</li>";
        if (admin_session == true){
          fragment += admin_action;
        }
        fragment +=  "</ul>";
        $('#list').append(fragment);
      });
    }
  });
}
</script>
